<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XE5XMQR0Z1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-XE5XMQR0Z1');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=400, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>小朋友開支票</title>
    <style>
    :root {
        --primary-color: #333333;
        --secondary-color: #4a4a4a;
        --text-color: #ffffff;
        --border-color: #555555;
        --hover-color: #666666;
        --shadow-color: rgba(0, 0, 0, 0.3);
        --button-orange: #ff9c33;
        --button-blue: #33b5e5;
        --button-grey: #333333;
    }

    html, body {
        width: 100%;
        max-width: 400px;
        margin: 0 auto;
        position: relative;
        overflow-x: hidden;
        -webkit-text-size-adjust: 100%;
        padding: 0 3px;
        background-color: #333333;
        color: var(--text-color);
        font-family: "Microsoft JhengHei", Arial, sans-serif;
        box-sizing: border-box;
    }

    h1 {
        color: var(--text-color);
        font-size: 22px;
        margin-bottom: 0px;
        border-bottom: 2px solid var(--button-orange);
        padding-bottom: 5px;
        position: relative;
        transition: all 0.3s ease;
        text-align: center;
    }

    h1:hover {
        transform: translateY(-2px);
        text-shadow: 0 2px 4px rgba(255, 156, 51, 0.3);
    }

    h1::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: var(--button-orange);
        transform: scaleX(0);
        transform-origin: right;
        transition: transform 0.6s ease-out;
    }

    h1:hover::after {
        transform: scaleX(1);
        transform-origin: left;
    }

    .time-display-wrapper {
        position: relative;
        height: auto;
        margin: 3px 0;
        z-index: 1000;
    }

    .sticky-header {
        position: -webkit-sticky !important;
        position: sticky !important;
        top: 0;
        background: var(--secondary-color);
        padding: 8px;
        border-radius: 4px;
        box-shadow: 0 2px 4px var(--shadow-color);
        animation: fadeIn 0.8s ease-out;
        transition: all 0.3s ease;
        z-index: 999;
        width: calc(100% - 16px);
        margin: 0 auto;
    }

    #timeDisplay {
        margin: 3px 0;
        font-size: 15px;
        background: var(--secondary-color);
        color: var(--text-color);
        padding: 8px;
        border-radius: 4px;
        box-shadow: 0 2px 4px var(--shadow-color);
        animation: fadeIn 0.8s ease-out;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    #timeDisplay:hover {
        transform: scale(1.02);
        box-shadow: 0 6px 12px var(--shadow-color);
    }

    #timeDisplay::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, var(--button-orange), transparent);
        animation: timelineSlide 3s linear infinite;
    }

    @keyframes timelineSlide {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    .time-label {
        font-weight: bold;
        margin-right: 10px;
        color: var(--button-orange);
    }

    .row {
        margin: 4px 0;
        display: flex;
        align-items: center;
        background: var(--secondary-color);
        padding: 3px;
        border-radius: 4px;
        box-shadow: 0 4px 8px var(--shadow-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
        transform-origin: left;
        will-change: transform;
    }

    .row:hover {
        transform: translateX(5px);
        box-shadow: 0 6px 12px var(--shadow-color);
    }

    .row:hover::before {
        content: '';
        position: absolute;
        left: -5px;
        top: 50%;
        width: 3px;
        height: 0;
        background: var(--button-orange);
        animation: expandHeight 0.3s forwards;
    }

    @keyframes expandHeight {
        to {
            height: 100%;
            top: 0;
        }
    }

    .label {
        width: 110px;  /* 減少寬度 */
        margin-right: 10px;  /* 減少右邊距 */
        text-align: right;
        font-weight: 600;
        color: var(--text-color);
        position: relative;
        overflow: hidden;
    }

    input {
        width: 210px;  /* 略微增加寬度以彌補標籤縮小的空間 */
        padding: 5px 12px;
        margin-right: 10px;
        background-color: #222222;
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    input:focus {
        outline: none;
        border-color: var(--button-orange);
        box-shadow: 0 0 0 3px rgba(255, 156, 51, 0.2);
        transform: scale(1.07);
    }

    .readonly {
        background-color: #222222;
        animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.8; }
    }

    button {
        background-color: var(--secondary-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 3px 8px;
        margin: 0 5px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 16px;
    }

    button:hover {
        background-color: var(--hover-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    button:active {
        transform: scale(0.95) translateY(1px);
        transition: transform 0.1s;
    }

    .divider-flow {
        position: relative;
        height: 2px;
        background: linear-gradient(90deg, 
            var(--secondary-color) 0%,
            var(--button-orange) 50%,
            var(--secondary-color) 100%);
        margin: 4px 0;
        overflow: hidden;
    }

    .divider-flow::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg,
            transparent,
            rgba(255, 156, 51, 0.8),
            transparent);
        animation: flowLight 3s ease-in-out infinite;
    }

    @keyframes flowLight {
        0% { transform: translateX(0); }
        100% { transform: translateX(200%); }
    }

    .warning-text {
        color: #ff0000 !important;
        font-weight: bold !important;
        animation: pulse 1s infinite, shake 0.5s ease-in-out; 
        will-change: transform; 
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-1px); }
        40%, 80% { transform: translateX(1px); }
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .input-button-group {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin: 4px 0;
        padding: 1px;
        background: var(--secondary-color);
        box-shadow: 0 4px 8px var(--shadow-color);
        position: relative;
        overflow: hidden;
    }

    .input-button-group .row {
        background: transparent;
        box-shadow: none;
        margin: 2px 0;
        padding-top: 1px;
        padding-bottom: 1px;
    }

    .input-button-group .row:hover {
        transform: translateX(2px);
        box-shadow: none;
    }

    .input-button-group .row:hover::before {
        display: none;
    }

    /* 修改 #checkCountButtons 樣式 */
    #checkCountButtons {
        margin: 0;
        display: flex;
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        min-height: 32px;
        justify-content: space-between;
    }

    #checkCountButtons button {
        flex: 1;
        margin: 0 3px;
        padding: 4px 0;
        min-width: 0;
        font-size: 15px;
    }

    /* 特別處理首尾按鈕 */
    #checkCountButtons button:first-child {
        margin-left: 0;
    }

    #checkCountButtons button:last-child {
        margin-right: 0;
    }

    #checkCountButtons button:hover {
        background-color: rgba(255, 156, 51, 0.15);
        color: #ffffff;
        border-color: var(--button-orange);
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(255, 156, 51, 0.2);
    }

    #checkCountButtons button:active {
        transform: translateY(1px);
        background-color: rgba(255, 156, 51, 0.3);
        box-shadow: 0 0 5px rgba(255, 156, 51, 0.5) inset;
        transition: all 0.1s ease;
    }

    .footer-message {
        background-color: #333333;
        color: var(--text-color);
        padding: 15px;
        text-align: center;
        margin-top: 15px;
        border-radius: 4px;
        transform: scale(1.05);
        text-shadow: 0 0 10px var(--button-orange);
        transition: all 0.3s ease;
        position: relative;
    }

    .footer-spacing {
        background-color: #333333;
        height: 50px;
        margin-top: 0px;
    }

    /* Number Input Modal */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        justify-content: center;
        align-items: center;
    }

    .number-input-modal {
        background-color: var(--primary-color);
        border-radius: 12px;
        width: 90%;
        max-width: 300px; /* 更窄一點 */
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        animation: modalSlideIn 0.3s ease-out;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background-color: var(--secondary-color);
        border-bottom: 1px solid var(--border-color);
    }

    .modal-header h3 {
        margin: 0;
        color: var(--button-orange);
        font-size: 16px;
    }

    .calculator-display {
        background-color: #222222;
        color: var(--text-color);
        font-size: 28px; /* 增加字體大小 */
        padding: 8px 15px; /* 減少上下內邊距 */
        text-align: right;
        margin: 8px;
        border-radius: 5px;
        border: 1px solid var(--border-color);
        height: 36px; /* 減少高度 */
        display: flex;
        align-items: center;
        justify-content: flex-end;
        overflow: hidden;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3); /* 添加內陰影效果 */
    }

    .calculator-buttons {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(5, auto);
        gap: 4px;
        padding: 6px;
    }

    .calculator-buttons button {
        padding: 8px 0;
        font-size: 17px;
        border-radius: 8px;
        background-color: #3a3a3a;
        color: var(--text-color);
        border: none;
        transition: all 0.2s ease;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 38px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: hidden;
    }

    .calculator-buttons button:hover {
        background-color: #464646;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .calculator-buttons button:active {
        transform: scale(0.95);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    /* 按鈕按下後產生波紋效果 */
    .calculator-buttons button::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%, -50%);
        transform-origin: 50% 50%;
    }

    .calculator-buttons button:active::after {
        animation: ripple 0.4s ease-out;
    }

    @keyframes ripple {
        0% {
            transform: scale(0, 0) translate(-50%, -50%);
            opacity: 0.5;
        }
        100% {
            transform: scale(20, 20) translate(-50%, -50%);
            opacity: 0;
        }
    }

    /* 功能鍵樣式 */
    .calculator-buttons .function {
        background-color: #4d4d4d;
        color: #eee;
        font-weight: bold;
    }

    /* 運算符號樣式 */
    .calculator-buttons .operator {
        background-color: rgba(255, 156, 51, 0.9);
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(255, 156, 51, 0.4);
    }

    /* 清除鍵樣式 */
    .calculator-buttons .clear {
        background-color: rgba(231, 76, 60, 0.9);
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(231, 76, 60, 0.4);
    }

    /* 等號鍵樣式 */
    .calculator-buttons .equals {
        background-color: rgba(52, 152, 219, 0.9);
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(52, 152, 219, 0.4);
    }

    /* 零鍵佔據兩欄 */
    .calculator-buttons .zero {
        grid-column: span 2;
        background-color: #3a3a3a;
    }

    /* 提交按鈕佔據兩欄 */
    .calculator-buttons .submit {
        grid-column: span 2;
        background-color: var(--button-orange);
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(255, 156, 51, 0.4);
    }

    /* 移除模態框底部的確認按鈕 */
    .modal-footer {
        display: none;
    }

    /* Toast message */
    .toast-message {
        position: fixed;
        bottom: 60px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(51, 181, 229, 0.9);
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 9999;
        font-weight: bold;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        opacity: 1;
        transition: opacity 0.5s ease;
    }

    .toast-error {
        background-color: rgba(231, 76, 60, 0.9);
    }

    /* Date picker styles */
    .date-picker {
        background-color: var(--primary-color);
        border-radius: 16px;
        width: 90%;
        max-width: 320px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        animation: modalSlideIn 0.3s ease-out;
    }

    .date-picker-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        background-color: var(--secondary-color);
        border-bottom: 1px solid var(--border-color);
    }

    .date-picker-header h3 {
        margin: 0;
        color: var(--button-orange);
        font-size: 17px;
        font-weight: bold;
    }

    .date-picker-controls {
        display: flex;
        justify-content: space-between;
        padding: 10px 15px;
        background-color: var(--secondary-color);
        align-items: center;
    }

    .date-picker-controls button {
        background-color: rgba(255, 156, 51, 0.1);
        color: var(--text-color);
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }

    .date-picker-controls button:hover {
        background-color: rgba(255, 156, 51, 0.2);
        transform: scale(1.1);
    }

    .date-picker-controls .month-year {
        color: var(--text-color);
        font-weight: bold;
        font-size: 15px;
    }

    /* 增加滑動互動區域的樣式 */
    .date-scroll-container {
        position: relative;
        overflow: hidden;
        touch-action: pan-y;
    }

    .month-slider {
        transition: transform 0.3s ease;
        height: 280px; /* 添加固定高度 */
    }

    /* 月份切換動畫 */
    @keyframes slideInUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    @keyframes slideInDown {
        from { transform: translateY(-20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .animate-up {
        animation: slideInUp 0.3s forwards;
    }

    .animate-down {
        animation: slideInDown 0.3s forwards;
    }

    .date-picker-calendar {
        padding: 10px;
        position: relative;
        transition: height 0.3s ease;
        height: 320px; /* 添加固定高度 */
    }

    .date-picker-calendar .weekdays .weekend {
        color: rgba(255, 156, 51, 0.8);
    }

    .date-picker-calendar .days button.weekend:not(:disabled) {
        background-color: rgba(82, 82, 82, 0.7);
    }

    .date-picker-calendar .days button.weekend:hover:not(:disabled) {
        background-color: rgba(255, 156, 51, 0.3);
    }

    .date-picker-calendar .weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        margin-bottom: 8px;
    }

    .date-picker-calendar .weekdays span {
        color: var(--button-orange);
        font-weight: bold;
        font-size: 14px;
        padding: 6px 0;
    }

    .date-picker-calendar .days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-template-rows: repeat(6, 1fr); /* 固定6行，確保所有月份都能顯示 */
        gap: 4px;
        height: 100%;
    }

    .date-picker-calendar .days button {
        padding: 8px;
        background-color: rgba(74, 74, 74, 0.7);
        border: none;
        border-radius: 50%;
        width: 38px;
        height: 38px;
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
    }

    .date-picker-calendar .days button:hover:not(:disabled) {
        background-color: rgba(255, 156, 51, 0.3);
        transform: scale(1.1);
    }

    .date-picker-calendar .days button.selected {
        background-color: var(--button-orange);
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 8px rgba(255, 156, 51, 0.5);
    }

    .date-picker-calendar .days button.today:not(.selected) {
        border: 2px solid var(--button-orange);
    }

    .date-picker-calendar .days button:disabled {
        opacity: 0.3;
        cursor: not-allowed;
        background-color: rgba(60, 60, 60, 0.5);
    }

    .date-picker-footer {
        padding: 12px 15px;
        display: flex;
        justify-content: space-between;
        background-color: var(--secondary-color);
        border-top: 1px solid var(--border-color);
    }

    .date-picker-footer button {
        padding: 8px 15px;
        background-color: var(--button-orange);
        border: none;
        border-radius: 6px;
        color: white;
        font-weight: bold;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .date-picker-footer button:hover {
        background-color: #e88a22;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    /* Check date list */
    .check-date-list {
        margin: 10px 0;
    }

    .check-date-list .list-header {
        display: flex;
        background-color: var(--secondary-color);
        padding: 8px 10px;
        border-radius: 4px 4px 0 0;
        font-weight: bold;
        border-bottom: 1px solid var(--border-color);
    }

    /* 添加以下 CSS 樣式 */
    .check-date-list .list-header .list-date {
        padding-left: 80px; /* 從20px增加到40px，使標題更靠右 */
    }

    .check-date-list .list-item {
        display: flex;
        background-color: #444444;
        padding: 8px 10px;
        border-bottom: 1px solid var(--border-color);
        transition: background-color 0.2s ease;
    }

    .check-date-list .list-item:nth-child(odd) {
        background-color: #3d3d3d;
    }

    .check-date-list .list-item:hover {
        background-color: #505050;
    }

    .check-date-list .list-number {
        width: 50px;
        text-align: center;
    }

    /* 新增以下樣式 */
    .check-date-list .hold-amount-row {
        background-color: #4a4a4a;
        border-top: none;
        border-radius: 0 0 8px 8px;
        margin-top: -1px;
        padding-top: 0;
    }

    .check-date-list .date-line {
        display: flex;
        align-items: center;
    }

    .check-date-list .last-item {
        border-bottom: none;
        border-radius: 0;
        margin-bottom: 0;
    }

    /* 讓列表項有交替色 */
    .check-date-list .list-item:nth-child(even) {
        background-color: #424242;
    }

    /* 修改 .check-date-list .list-date 樣式 */
    .check-date-list .list-date {
        flex: 1;
        text-align: left;  /* 從 center 改為 left */
        padding-left: 10px; /* 添加左側間距 */
    }

    /* 美化最後一項 */
    .check-date-list .last-item {
        background-color: #4a4a4a;
        border-radius: 0 0 8px 8px;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        border-bottom: 2px solid var(--button-orange);
    }

    /* 美化日期顯示 */
    .check-date-list .date-content {
        display: flex;
        align-items: center;
        margin-bottom: 4px;
    }

    /* 美化押票金額顯示 */
    .check-date-list .hold-amount {
        background-color: rgba(255, 156, 51, 0.1);
        padding: 8px;
        border-radius: 4px;
        font-weight: bold;
        display: inline-block;
        margin-top: 4px;
        width: calc(100% - 16px); /* 減去左右padding */
    }

    /* 添加以下 CSS 樣式 */
    .check-date-list .list-date {
        display: flex;
        align-items: center;
    }

    .check-date-list .list-date .date-part {
        flex: 1;
        white-space: nowrap; /* 防止日期換行 */
        padding-right: 5px; /* 右側加一點內邊距 */
    }

    .check-date-list .list-date .weekday-part {
        width: 30px; /* 縮小寬度 */
        text-align: left;
        margin-left: -5px; /* 使用負邊距拉近距離 */
        padding-left: 0;
        color: rgba(255, 156, 51, 0.9); /* 加入淡橙色以提高辨識度 */
    }

    .check-date-list .list-remaining {
        width: 80px;
        text-align: center;
    }

    .check-date-list .list-header .list-remaining {
        font-weight: bold;
    }

    /* 年度分隔符樣式 */
        .check-date-list .year-separator {
        position: relative;
        height: 1px;
        background: linear-gradient(90deg, 
            transparent 0%, 
            rgba(255, 156, 51, 0.3) 50%, 
            transparent 100%);
        margin: 8px 0;
        text-align: center;
    }

    .check-date-list .year-separator span {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(74, 74, 74, 0.9);
        padding: 1px 8px;
        font-size: 12px;
        color: rgba(255, 156, 51, 0.9);
        border-radius: 8px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        letter-spacing: 1px;
        font-weight: 500;
    }

    /* 美化押票金額顯示區塊 */
    .hold-amount-container {
        background-color: rgba(255, 156, 51, 0.05);
        border-radius: 0 0 8px 8px;
        margin-top: -1px;
        padding: 10px;
        border-top: 1px solid rgba(255, 156, 51, 0.2);
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .hold-amount-title {
        color: var(--button-orange);
        font-weight: bold;
        font-size: 15px;
        margin-bottom: 6px;
        padding-left: 5px;
        border-left: 3px solid var(--button-orange);
    }

    .hold-amount-value {
        background-color: rgba(255, 156, 51, 0.1);
        padding: 10px;
        border-radius: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 6px;
    }

    .hold-amount-number {
        font-size: 16px;
        font-weight: bold;
    }

    .hold-amount-uppercase {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.9);
        background-color: rgba(255, 156, 51, 0.2);
        padding: 8px 10px;
        border-radius: 6px;
        width: 100%;
        margin-top: 6px;
        text-align: center;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    </style>
</head>
<body>
    <div style="text-align: center;">
        <h1>小朋友開支票</h1>
    </div>
    
    <div class="time-display-wrapper">
        <div id="timeDisplay" class="sticky-header">
            <div style="display: flex; justify-content: center; width: 100%;">
                <span class="time-label">現在時間：</span>
                <span id="currentTime"></span>
            </div>
        </div>
    </div>
    
    <div class="row">
        <span class="label">總金額</span>
        <input type="text" id="totalAmount" readonly placeholder="點擊輸入總金額">
    </div>
    
    <div class="row">
        <span class="label">繳款金額</span>
        <input type="text" id="paymentAmount" readonly placeholder="點擊輸入繳款金額">
    </div>
    
    <div class="input-button-group">
        <div class="row">
            <span class="label">開票張數</span>
            <input type="text" id="checkCount" readonly placeholder="點擊輸入開票張數">
        </div>
        
        <div id="checkCountButtons">
            <button onclick="adjustCheckCount(-1)">-1</button>
            <button onclick="setCheckCount(7)">7</button>
            <button onclick="setCheckCount(13)">13</button>
            <button onclick="setCheckCount(19)">19</button>
            <button onclick="setCheckCount(25)">25</button>
            <button onclick="adjustCheckCount(1)">+1</button>
        </div>
    </div>
    
    <div class="row">
        <span class="label">押票金額</span>
        <input type="text" id="holdAmount" class="readonly" readonly>
    </div>
    
    <div class="row">
        <span class="label">開始日期</span>
        <input type="text" id="startDate" readonly placeholder="點擊選擇開始日期">
    </div>

    <div class="row">
        <span class="label">押票日期</span>
        <input type="text" id="holdDate" class="readonly" readonly>
    </div>
    
    <div class="divider-flow"></div>
    
    <div class="row" style="justify-content: center;">
        <span class="label">開票日期列表</span>
    </div>
    
    <div id="checkDateList" class="check-date-list">
        <!-- 動態生成的開票日期列表 -->
    </div>
    
    <div class="footer-message">開完支票記得要吃碗火雞肉飯唷！</div>
    
    <div class="footer-spacing"></div>
    
    <!-- 數字輸入器模態框 -->
    <div id="numberInputModal" class="modal-overlay">
        <div class="number-input-modal">
            <div class="modal-header">
                <h3 id="inputModalTitle">數字輸入器</h3>
                <button class="close-btn" onclick="closeModal('numberInputModal')">×</button>
            </div>
            <div class="calculator-display" id="calculatorDisplay">0</div>
            <div class="calculator-buttons">
                <!-- 第一行：功能鍵 -->
                <button onclick="calculatorClear()" class="clear">C</button>
                <button onclick="calculatorBackspace()" class="function">⌫</button>
                <button onclick="calculatorOperation('/')" class="operator">÷</button>
                <button onclick="calculatorOperation('*')" class="operator">×</button>
                
                <!-- 第二行：數字和減號 -->
                <button onclick="calculatorInput(7)">7</button>
                <button onclick="calculatorInput(8)">8</button>
                <button onclick="calculatorInput(9)">9</button>
                <button onclick="calculatorOperation('-')" class="operator">−</button>
                
                <!-- 第三行：數字和加號 -->
                <button onclick="calculatorInput(4)">4</button>
                <button onclick="calculatorInput(5)">5</button>
                <button onclick="calculatorInput(6)">6</button>
                <button onclick="calculatorOperation('+')" class="operator">+</button>
                
                <!-- 第四行：底部數字和等號 -->
                <button onclick="calculatorInput(1)">1</button>
                <button onclick="calculatorInput(2)">2</button>
                <button onclick="calculatorInput(3)">3</button>
                <button onclick="calculatorEquals()" class="equals">=</button>
                
                <!-- 第五行：零和更寬的等號鍵 -->
                <button onclick="calculatorInput(0)" class="zero">0</button>
                <button onclick="submitCalculatorValue()" class="submit">確認輸入</button>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="submitCalculatorValue()">輸入</button>
            </div>
        </div>
    </div>
    
    <!-- 日期選擇器模態框 -->
    <div id="datePickerModal" class="modal-overlay">
        <div class="date-picker">
            <div class="date-picker-header">
                <h3>選擇日期</h3>
                <button class="close-btn" onclick="closeModal('datePickerModal')">×</button>
            </div>
            <div class="date-picker-controls">
                <button onclick="prevMonthWithAnimation()">&lt;</button>
                <span class="month-year" id="currentMonthYear"></span>
                <button onclick="nextMonthWithAnimation()">&gt;</button>
            </div>
            <div class="date-scroll-container">
                <div class="date-picker-calendar" id="datePickerCalendar">
                    <div class="weekdays">
                        <span class="weekend">日</span>
                        <span>一</span>
                        <span>二</span>
                        <span>三</span>
                        <span>四</span>
                        <span>五</span>
                        <span class="weekend">六</span>
                    </div>
                    <div class="month-slider" id="monthSlider">
                        <div class="days" id="calendarDays">
                            <!-- 動態生成的日期 -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="date-picker-footer">
                <button class="modal-btn modal-btn-primary" onclick="selectToday()">今天</button>
                <button class="modal-btn modal-btn-primary" onclick="confirmDate()">確認</button>
            </div>
        </div>
    </div>

<script>
    // 全局變量
    let currentInputField = null;
    let calculatorValue = "0";
    let calculatorOperator = null;
    let calculatorFirstValue = null;
    let calculatorWaitingForSecondValue = false;
    let selectedDate = null;
    let currentDatePickerDate = new Date();

    // 將數字轉換為中文大寫函數 (改進版)
    function numberToChineseUppercase(num) {
        if (isNaN(num)) return '';
        
        // 移除逗號和空格
        num = num.toString().replace(/,|\s/g, '');
        
        const digits = ['零', '壹', '貳', '參', '肆', '伍', '陸', '柒', '捌', '玖'];
        const units = ['', '拾', '佰', '仟', '萬', '拾', '佰', '仟', '億', '拾', '佰', '仟', '兆'];
        
        // 特別處理0
        if (parseInt(num) === 0) return '零元整';
        
        // 處理整數部分
        let result = '';
        let zeroFlag = false;
        let hasAddedUnit = false;
        
        for (let i = 0; i < num.length; i++) {
            const n = parseInt(num[i]);
            const unit = units[num.length - 1 - i];
            
            if (n === 0) {
                // 特殊處理：萬、億位的零
                if ((num.length - 1 - i) === 4 || (num.length - 1 - i) === 8) {
                    // 判斷該位置之前是否有有效數字
                    let hasValidDigitBefore = false;
                    for (let j = 0; j < i; j++) {
                        if (parseInt(num[j]) !== 0) {
                            hasValidDigitBefore = true;
                            break;
                        }
                    }
                    
                    if (hasValidDigitBefore && !result.endsWith(unit)) {
                        result += unit;
                        hasAddedUnit = true;
                    }
                }
                zeroFlag = true;
            } else {
                // 處理非零數字
                if (zeroFlag && i > 0 && !hasAddedUnit) {
                    result += '零';
                }
                result += digits[n] + unit;
                zeroFlag = false;
                hasAddedUnit = false;
            }
        }
        
        return result + '元整';
    }

    // 當頁面加載完成
    document.addEventListener('DOMContentLoaded', function() {
        // 初始化時間顯示
        updateTime();
        setInterval(updateTime, 1000);
        
        // 設置輸入框點擊事件
        document.getElementById('totalAmount').addEventListener('click', function() {
            openCalculator('totalAmount', '請輸入【總金額】');
        });
        
        document.getElementById('paymentAmount').addEventListener('click', function() {
            openCalculator('paymentAmount', '請輸入【繳款金額】');
        });
        
        document.getElementById('checkCount').addEventListener('click', function() {
            openCalculator('checkCount', '請輸入【開票張數】');
        });
        
        document.getElementById('startDate').addEventListener('click', function() {
            openDatePicker();
        });
        
        // 監聽數值變化，計算押票金額
        ['totalAmount', 'paymentAmount', 'checkCount'].forEach(function(id) {
            document.getElementById(id).addEventListener('change', calculateHoldAmount);
        });

        // 點擊模態框背景關閉模態框
        document.getElementById('numberInputModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal('numberInputModal');
            }
        });

        // 點擊模態框背景關閉日期選擇器
        document.getElementById('datePickerModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal('datePickerModal');
            }
        });

        // 添加日期選擇器滑動切換月份功能
        const datePickerCalendar = document.getElementById('datePickerCalendar');
        let startY = 0;
        let startTime = 0;
        let isSwiping = false;

        datePickerCalendar.addEventListener('touchstart', function(e) {
            startY = e.touches[0].clientY;
            startTime = Date.now();
            isSwiping = true;
        }, { passive: true });

        datePickerCalendar.addEventListener('touchmove', function(e) {
            if (!isSwiping) return;
            e.preventDefault();
        }, { passive: false });

        datePickerCalendar.addEventListener('touchend', function(e) {
            if (!isSwiping) return;
            
            const endY = e.changedTouches[0].clientY;
            const deltaY = endY - startY;
            const timeDiff = Date.now() - startTime;
            
            // 滑動距離至少20px且時間不超過300ms才算有效滑動
            if (Math.abs(deltaY) > 20 && timeDiff < 300) {
                if (deltaY > 0) {
                    // 下滑，顯示上個月
                    prevMonthWithAnimation();
                } else {
                    // 上滑，顯示下個月
                    nextMonthWithAnimation();
                }
            }
            
            isSwiping = false;
        }, { passive: true });
    });
    
    // 更新時間顯示（民國年）
    function updateTime() {
        const now = new Date();
        const days = ['日', '一', '二', '三', '四', '五', '六'];
        
        // 轉換為民國年
        const rocYear = now.getFullYear() - 1911;
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const day = days[now.getDay()];
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        
        const timeString = `民國${rocYear}年${month}月${date}日 星期${day} ${hours}:${minutes}:${seconds}`;
        document.getElementById('currentTime').textContent = timeString;
    }
    
    // 開啟計算機輸入器
    function openCalculator(inputId, title) {
        currentInputField = inputId;
        document.getElementById('inputModalTitle').textContent = title ;
        document.getElementById('calculatorDisplay').textContent = '0';
        calculatorValue = "0";
        calculatorOperator = null;
        calculatorFirstValue = null;
        calculatorWaitingForSecondValue = false;
        
        document.getElementById('numberInputModal').style.display = 'flex';
        
        // 添加震動效果
        if (navigator.vibrate) {
            navigator.vibrate(30);
        }
    }
    
    // 關閉模態框
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }
    
    // 計算機數字輸入
    function calculatorInput(num) {
        if (calculatorWaitingForSecondValue) {
            calculatorValue = num.toString();
            calculatorWaitingForSecondValue = false;
        } else {
            calculatorValue = calculatorValue === '0' ? num.toString() : calculatorValue + num.toString();
        }
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
    }
    
    // 計算機清除
    function calculatorClear() {
        calculatorValue = '0';
        calculatorOperator = null;
        calculatorFirstValue = null;
        calculatorWaitingForSecondValue = false;
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
    }
    
    // 計算機退格
    function calculatorBackspace() {
        if (calculatorValue.length > 1) {
            calculatorValue = calculatorValue.slice(0, -1);
        } else {
            calculatorValue = '0';
        }
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
    }
    
    // 計算機小數點
    function calculatorDecimal() {
        if (!calculatorValue.includes('.')) {
            calculatorValue += '.';
        }
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
    }
    
    // 計算機百分比
    function calculatorPercent() {
        calculatorValue = (parseFloat(calculatorValue) / 100).toString();
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
    }
    
    // 計算機運算符
    function calculatorOperation(op) {
        // 如果已有第一個值和運算符，先進行計算
        if (calculatorFirstValue !== null && calculatorOperator !== null && !calculatorWaitingForSecondValue) {
            calculatorEquals();
        }
        
        calculatorFirstValue = parseFloat(calculatorValue);
        calculatorOperator = op;
        calculatorWaitingForSecondValue = true;
    }
    
    // 計算機等號
    function calculatorEquals() {
        if (calculatorOperator === null) return;
        
        const secondValue = parseFloat(calculatorValue);
        let result;
        
        switch (calculatorOperator) {
            case '+':
                result = calculatorFirstValue + secondValue;
                break;
            case '-':
                result = calculatorFirstValue - secondValue;
                break;
            case '*':
                result = calculatorFirstValue * secondValue;
                break;
            case '/':
                result = calculatorFirstValue / secondValue;
                break;
            default:
                return;
        }
        
        calculatorValue = result.toString();
        document.getElementById('calculatorDisplay').textContent = calculatorValue;
        calculatorOperator = null;
        calculatorFirstValue = result;
        calculatorWaitingForSecondValue = true;
    }
    
    // 提交計算機值
    function submitCalculatorValue() {
        if (!currentInputField) return;
        
        let value = parseFloat(calculatorValue);
        if (isNaN(value)) value = 0;
        
        // 根據不同輸入框進行驗證
        switch (currentInputField) {
            case 'totalAmount':
                // 驗證總金額（不超過9位數的正整數）
                value = Math.floor(value);
                if (value > 999999999) {
                    showToast('錯誤：總金額不能超過9位數', true);
                    return;
                }
                break;
                
            case 'paymentAmount':
                // 驗證繳款金額（不超過7位數的正整數）
                value = Math.floor(value);
                if (value > 9999999) {
                    showToast('錯誤：繳款金額不能超過7位數', true);
                    return;
                }
                break;
                
            case 'checkCount':
                // 驗證開票張數（不超過2位數的正整數）
                value = Math.floor(value);
                if (value > 99) {
                    showToast('錯誤：開票張數不能超過2位數', true);
                    return;
                }
                break;
        }
        
        // 格式化顯示並更新輸入框
        document.getElementById(currentInputField).value = value.toLocaleString();
        
        // 觸發 change 事件以更新其他相關計算
        const event = new Event('change');
        document.getElementById(currentInputField).dispatchEvent(event);
        
        // 關閉模態框
        closeModal('numberInputModal');
        
        // 添加震動效果
        if (navigator.vibrate) {
            navigator.vibrate(30);
        }
    }
    
    // 顯示提示訊息
    function showToast(message, isError = false) {
        // 移除現有的 toast
        const existingToast = document.querySelector('.toast-message');
        if (existingToast) {
            document.body.removeChild(existingToast);
        }
        
        // 創建新的 toast
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        if (isError) {
            toast.classList.add('toast-error');
        }
        toast.textContent = message;
        document.body.appendChild(toast);
        
        // 2秒後自動消失
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                }
            }, 500);
        }, 2000);
    }
    
    // 計算押票金額
    function calculateHoldAmount() {
        const totalAmountEl = document.getElementById('totalAmount');
        const paymentAmountEl = document.getElementById('paymentAmount');
        const checkCountEl = document.getElementById('checkCount');
        const holdAmountEl = document.getElementById('holdAmount');
        
        // 檢查是否所有必要欄位都已填寫
        if (!totalAmountEl.value || !paymentAmountEl.value || !checkCountEl.value) {
            holdAmountEl.value = '';
            return;
        }
        
        // 解析數值（移除千位分隔符）
        const totalAmount = parseInt(totalAmountEl.value.replace(/,/g, ''));
        const paymentAmount = parseInt(paymentAmountEl.value.replace(/,/g, ''));
        const checkCount = parseInt(checkCountEl.value.replace(/,/g, ''));
        
        // 計算押票金額
        const holdAmount = totalAmount - (paymentAmount * checkCount);
        
        // 更新押票金額
        if (holdAmount <= 0) {
            holdAmountEl.value = '0';
            holdAmountEl.classList.add('warning-text');
            showToast('錯誤：押票金額必須大於零', true);
        } else {
            holdAmountEl.value = holdAmount.toLocaleString();
            holdAmountEl.classList.remove('warning-text');
        }
        
        // 如果開始日期已設置，更新開票日期列表
        if (document.getElementById('startDate').value) {
            updateCheckDateList();
        }
    }
    
    // 調整開票張數
    function adjustCheckCount(delta) {
        const checkCountEl = document.getElementById('checkCount');
        if (!checkCountEl.value) return;
        
        let count = parseInt(checkCountEl.value.replace(/,/g, '')) + delta;
        if (count < 1) count = 1;
        if (count > 99) count = 99;
        
        checkCountEl.value = count.toLocaleString();
        
        // 觸發 change 事件
        const event = new Event('change');
        checkCountEl.dispatchEvent(event);
        
        // 添加震動效果
        if (navigator.vibrate) {
            navigator.vibrate(30);
        }
    }
    
    // 設置開票張數
    function setCheckCount(count) {
        const checkCountEl = document.getElementById('checkCount');
        checkCountEl.value = count.toLocaleString();
        
        // 觸發 change 事件
        const event = new Event('change');
        checkCountEl.dispatchEvent(event);
        
        // 添加震動效果
        if (navigator.vibrate) {
            navigator.vibrate(30);
        }
    }
    
    // 打開日期選擇器
    function openDatePicker() {
        // 初始化日期選擇器的當前日期
        currentDatePickerDate = new Date();
        selectedDate = null;
        
        // 顯示日期選擇器
        updateDatePickerCalendar();
        document.getElementById('datePickerModal').style.display = 'flex';
        
        // 添加震動效果
        if (navigator.vibrate) {
            navigator.vibrate(30);
        }
    }
    
    // 更新日期選擇器日曆
    function updateDatePickerCalendar() {
        const year = currentDatePickerDate.getFullYear();
        const month = currentDatePickerDate.getMonth();
        
        // 更新標題
        document.getElementById('currentMonthYear').textContent = 
            `民國${year - 1911}年${month + 1}月`;
        
        // 獲取當月的第一天是星期幾
        const firstDay = new Date(year, month, 1).getDay();
        
        // 獲取當月的天數
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        // 獲取今天的日期
        const today = new Date();
        
        // 獲取上個月的天數
        const prevMonth = month === 0 ? 11 : month - 1;
        const prevYear = month === 0 ? year - 1 : year;
        const daysInPrevMonth = new Date(prevYear, prevMonth + 1, 0).getDate();
        
        // 生成日曆
        let calendarHTML = '';
        
        // 填充上個月的尾部日期（顯示前一週）
        for (let i = 0; i < firstDay; i++) {
            const prevMonthDay = daysInPrevMonth - firstDay + i + 1;
            const isWeekend = i === 0 || i === 6; // 週日或週六
            
            calendarHTML += `<button disabled class="${isWeekend ? 'weekend' : ''}" style="opacity: 0.2">
                            ${prevMonthDay}
                            </button>`;
        }
        
        // 填充當月日期
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const dayOfWeek = date.getDay();
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6; // 週日或週六
            
            const isToday = date.getDate() === today.getDate() && 
                        date.getMonth() === today.getMonth() && 
                        date.getFullYear() === today.getFullYear();
            
            const isSelected = selectedDate !== null && 
                            date.getDate() === selectedDate.getDate() && 
                            date.getMonth() === selectedDate.getMonth() && 
                            date.getFullYear() === selectedDate.getFullYear();
            
            // 早於今天的日期不能選擇
            const isPast = date < new Date(today.setHours(0, 0, 0, 0));
            
            calendarHTML += `<button 
                            ${isPast ? 'disabled' : ''} 
                            class="${isSelected ? 'selected' : ''} ${isToday ? 'today' : ''} ${isWeekend ? 'weekend' : ''}"
                            onclick="selectDate(${year}, ${month}, ${day})">
                            ${day}
                            </button>`;
        }
        
        // 填充下個月的開頭日期（顯示到下一週）
        const cellsUsed = firstDay + daysInMonth;
        const nextDays = 42 - cellsUsed; // 總是確保總格子數為42(7x6)
        for (let i = 1; i <= nextDays; i++) {
            const dayOfWeek = (firstDay + daysInMonth + i - 1) % 7;
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6; // 週日或週六
            
            calendarHTML += `<button disabled class="${isWeekend ? 'weekend' : ''}" style="opacity: 0.2">
                            ${i}
                            </button>`;
        }
        
        document.getElementById('calendarDays').innerHTML = calendarHTML;
    }
    
    // 選擇日期
    function selectDate(year, month, day) {
        selectedDate = new Date(year, month, day);
        updateDatePickerCalendar();
    }
    
    // 選擇今天
    function selectToday() {
        const today = new Date();
        currentDatePickerDate = today;
        selectedDate = today;
        updateDatePickerCalendar();
    }
    
    // 上個月
    function prevMonth() {
        currentDatePickerDate.setMonth(currentDatePickerDate.getMonth() - 1);
        updateDatePickerCalendar();
    }

    // 下個月
    function nextMonth() {
        currentDatePickerDate.setMonth(currentDatePickerDate.getMonth() + 1);
        updateDatePickerCalendar();
    }

    // 帶動畫效果的上個月函數
    function prevMonthWithAnimation() {
        const monthSlider = document.getElementById('monthSlider');
        monthSlider.classList.add('animate-down');
        
        setTimeout(() => {
            prevMonth();
            monthSlider.classList.remove('animate-down');
        }, 150);
    }

    // 帶動畫效果的下個月函數
    function nextMonthWithAnimation() {
        const monthSlider = document.getElementById('monthSlider');
        monthSlider.classList.add('animate-up');
        
        setTimeout(() => {
            nextMonth();
            monthSlider.classList.remove('animate-up');
        }, 150);
    }
    
    // 確認日期選擇
    function confirmDate() {
        if (!selectedDate) {
            showToast('請選擇一個日期');
            return;
        }
        
        // 格式化為民國年日期
        const rocYear = selectedDate.getFullYear() - 1911;
        const month = selectedDate.getMonth() + 1;
        const day = selectedDate.getDate();
        
        // 更新開始日期
        document.getElementById('startDate').value = `${rocYear}年${month}月${day}日 ${getWeekDay(selectedDate)}`;
        
        // 關閉日期選擇器
        closeModal('datePickerModal');
        
        // 更新開票日期列表
        updateCheckDateList();
        
        // 添加震動效果
        if (navigator.vibrate) {
            navigator.vibrate(30);
        }
    }

    // 獲取星期幾的簡短表示
    // 修改 getWeekDay 函數
    function getWeekDay(date) {
        const days = ['日', '一', '二', '三', '四', '五', '六'];
        return `(${days[date.getDay()]})`;  // 在星期數字兩側加括號
    }
    
    // 更新開票日期列表
    function updateCheckDateList() {
        const checkCountEl = document.getElementById('checkCount');
        const startDateEl = document.getElementById('startDate');
        const checkDateListEl = document.getElementById('checkDateList');
        
        // 如果缺少開票張數或開始日期，則清空列表
        if (!checkCountEl.value || !startDateEl.value) {
            checkDateListEl.innerHTML = '';
            return;
        }
        
        // 解析開票張數和開始日期
        const checkCount = parseInt(checkCountEl.value.replace(/,/g, ''));
        const startDateMatch = startDateEl.value.match(/(\d+)年(\d+)月(\d+)日/);
        
        if (!startDateMatch) {
            checkDateListEl.innerHTML = '';
            return;
        }
        
        const rocYear = parseInt(startDateMatch[1]);
        const startMonth = parseInt(startDateMatch[2]);
        const startDay = parseInt(startDateMatch[3]);
        const startYear = rocYear + 1911;
        
        // 創建開票日期列表 HTML
        // 在 updateCheckDateList 函數中
        let html = `
            <div class="list-header">
                <div class="list-number">編號</div>
                <div class="list-date">日期</div>
                <div class="list-remaining">剩餘張數</div>
            </div>
        `;

        /* 在循環開始前添加變量 */
        let previousYear = null;
        
        for (let i = 0; i < checkCount; i++) {
            // 計算當前票據的日期：初始日期加上i個月
            let currentDate = new Date(startYear, startMonth - 1 + i, startDay);

            // 獲取當月的天數
            const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();

            // 如果日期超過了當月的天數，則設為當月的最後一天
            if (currentDate.getDate() > daysInMonth) {
                currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), daysInMonth);
            }
            
            // 格式化為民國年日期
            const currentRocYear = currentDate.getFullYear() - 1911;
            const currentMonth = currentDate.getMonth() + 1;
            const currentDay = currentDate.getDate();
            const weekDay = getWeekDay(currentDate);

            /* 在循環內部添加跨年度檢測 */
            // 檢查是否與前一行跨年度
            const isYearChange = previousYear !== null && currentRocYear !== previousYear;
            previousYear = currentRocYear;

            /* 生成列表項時添加年度分隔符 */
            // 如果是跨年度且不是第一行，添加年度分隔符
            if (isYearChange) {
                html += `<div class="year-separator"><span>${currentRocYear}年</span></div>`;
            }

            // 計算剩餘張數
            const remainingCount = checkCount - i;
            
            // 檢查是否為最後一個項目
            if (i === checkCount - 1) {
                // 為最後一項添加押票金額
                const holdAmount = document.getElementById('holdAmount').value;
                const holdAmountUppercase = numberToChineseUppercase(holdAmount);
                html += `
                    <div class="list-item last-item">
                        <div class="list-number">${i + 1}</div>
                        <div class="list-date">
                            <div class="date-line">
                                <span class="date-part">${currentRocYear}年${currentMonth}月${currentDay}日</span>
                                <span class="weekday-part">${weekDay}</span>
                            </div>
                        </div>
                        <div class="list-remaining">${remainingCount}張</div>
                    </div>
                    <div class="hold-amount-wrapper">
                        <div class="hold-amount-header">
                            <div class="hold-amount-title">押票金額明細</div>
                            <div style="font-size: 12px; color: #aaa;">${new Date().toLocaleDateString('zh-TW')}</div>
                        </div>
                        <div class="hold-amount-value">
                            <span class="amount-number">${holdAmount} 元</span>
                            <span style="color: #aaa; font-size: 12px;">最終款項</span>
                        </div>
                        <div class="amount-uppercase">${holdAmountUppercase}</div>
                    </div>
                `;
            }
            else {
                // 添加到列表項中
                html += `
                    <div class="list-item">
                        <div class="list-number">${i + 1}</div>
                        <div class="list-date">
                            <span class="date-part">${currentRocYear}年${currentMonth}月${currentDay}日</span>
                            <span class="weekday-part">${weekDay}</span>
                        </div>
                        <div class="list-remaining">${remainingCount}張</div>
                    </div>
                `;
            }
        }
        
        checkDateListEl.innerHTML = html;

        // 在 updateCheckDateList 函數末尾添加以下代碼
        // 更新押票日期欄位
        if (checkCount > 0) {
            const lastIndex = checkCount - 1;
            let lastDate = new Date(startYear, startMonth - 1 + lastIndex, startDay);
            
            // 檢查日期是否有效（處理月份天數問題）
            const daysInLastMonth = new Date(lastDate.getFullYear(), lastDate.getMonth() + 1, 0).getDate();
            if (lastDate.getDate() > daysInLastMonth) {
                lastDate = new Date(lastDate.getFullYear(), lastDate.getMonth(), daysInLastMonth);
            }
            
            const lastRocYear = lastDate.getFullYear() - 1911;
            const lastMonth = lastDate.getMonth() + 1;
            const lastDay = lastDate.getDate();
            const lastWeekDay = getWeekDay(lastDate);
            
            document.getElementById('holdDate').value = `${lastRocYear}年${lastMonth}月${lastDay}日 ${lastWeekDay}`;
        }
    }
</script>
</body>
</html>